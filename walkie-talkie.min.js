/**
 * Walkie Talkie
 * https://github.com/zero-degrees/walkie-talkie
 *
 * @copyright 2017 Craig Russell
 * @license MIT
 */
!function(t){"use strict";t.fn.walkieTalkie=function(h){function e(t){var h,e,i=window.getComputedStyle(t),s=[];for(e=0;e<i.length;++e)h=i[e],s.push(h+":"+i[h]);return s.join(";")}var i=this;this.close=function(){t("#walkthrough, #walkthrough-shade").fadeOut(100,function(){t("body").css("overflowY","initial"),t("#walkthrough, #walkthrough-shade").remove()})},this.skip=function(t){confirm("Are you sure that you want to skip the walkthrough?")&&(t.stopPropagation(),this.close())},this.prev=function(){var t=this.steps[this.stepId];void 0!==t&&void 0!==t.callbacks&&void 0!==t.callbacks.prev&&t.callbacks.prev(this),--this.stepId,this.redrawStep()},this.next=function(){var t=this.steps[this.stepId];if(void 0!==t&&void 0!==t.callbacks&&void 0!==t.callbacks.next&&this.steps[this.stepId].callbacks.next(this),++this.stepId,void 0===this.steps[this.stepId])return void this.close();this.redrawStep()},this.redrawStep=function(){var h,i,s,o,a,d,l,r,n,w,u=t("#walkthrough-focus"),p=this.steps[this.stepId];0!=t("#walkthrough:visible").length&&(this.showMessage(),void 0!==p.focus&&p.focus?(h=t(p.focus),0==h.length?console.error("Invalid focus element selector on step "+this.stepId):(u.show(),needToScroll="fixed"!=h.css("position"),needToScroll&&this.scrollToElement(h),e(h[0]),i=h.offset(),s=i.top-window.scrollY,o=i.left-window.scrollX,a=t("#walkthrough-shade").width(),d=t("#walkthrough-shade").height(),l=o-6,l=l>0?l:0,r=o+h.outerWidth()+6,r=r<a?r:a,n=s-6,n=n>0?n:0,w=s+h.outerHeight()+6,w=w<d?w:d,u.height(w-n),u.width(r-l),t("#walkthrough-shade-left").width(o-6),t("#walkthrough-shade-top").height(s-6),u.show())):u.hide())},this.showMessage=function(){t("#walkthrough-message").html('<div id="walkthrough-message-container"></div>'),t("#walkthrough-message-container").html('<div id="walkthrough-message-body"></div>'),t("#walkthrough-message-body").html(this.steps[this.stepId].message),t("#walkthrough").removeClass("walkthrough-first-step"),t("#walkthrough").removeClass("walkthrough-last-step"),0==this.stepId&&t("#walkthrough").addClass("walkthrough-first-step"),this.stepId==this.steps.length-1&&t("#walkthrough").addClass("walkthrough-last-step"),t("#walkthrough-message-container").append('<a id="walkthrough-skip"></a>'),t("#walkthrough-skip").click(function(t){i.skip(t)}),t("#walkthrough-message-container").append('<div id="walkthrough-controls"></div>'),t("#walkthrough-controls").append('<div><div id="walkthrough-prev"></div></div>'),t("#walkthrough-controls").append('<div><div id="walkthrough-step"></div></div>'),t("#walkthrough-controls").append('<div><div id="walkthrough-next"></div></div>'),t("#walkthrough-step").text(this.stepId+1+" / "+this.steps.length),t("#walkthrough-prev").click(function(t){i.prev()}),t("#walkthrough-next").click(function(t){i.next()})},this.scrollToElement=function(t){var h=t.offset(),e=h.left-.1*window.innerWidth,i=h.top-.1*window.innerHeight;window.scrollTo(e,i),window.setTimeout(function(){window.scrollTo(e,i)},10)},function(){i.steps=h,i.stepId=-1,t("#walkthrough").remove(),t("body").css("overflowY","hidden"),t("body").append('<div id="walkthrough"></div>'),t("body").append('<div id="walkthrough-shade"></div>'),t("#walkthrough-shade").append('<div id="walkthrough-shade-left"></div>'),t("#walkthrough-shade").append('<div id="walkthrough-shade-center"></div>'),t("#walkthrough-shade").append('<div id="walkthrough-shade-right"></div>'),t("#walkthrough-shade-center").append('<div id="walkthrough-shade-top"></div>'),t("#walkthrough-shade-center").append('<div id="walkthrough-focus"></div>'),t("#walkthrough-shade-center").append('<div id="walkthrough-shade-bottom"></div>'),t("#walkthrough").append('<div id="walkthrough-message"></div>'),t("#walkthrough-message-container").click(function(t){t.stopPropagation()}),void 0===window.walkieTalkieInitialized&&(t(window).resize(function(){i.redrawStep()}),window.walkieTalkieInitialized=!0)}(),i.next()}}(jQuery);